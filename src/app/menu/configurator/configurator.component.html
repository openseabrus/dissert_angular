<!-- <div id="main" [ngClass]="{active: menuOpened}" (click)="setMenu()"> -->
<div id="main" (click)="setMenu()">
  <div class="header">
    <h1>Configuration Platform</h1>
  </div>

  <div class="content">

    <h2 class="content-subhead">New Rule Creation</h2>
    <form class="pure-form pure-form-stacked">
      <fieldset>
        <legend>Trigger</legend>

        <div class="pure-g">
          <div class="pure-u-1 pure-u-md-1-3 auto">
            <div class="pure-u-23-24">
              <label for="trigger-entity">Entity</label>
              <!-- <input [(ngModel)]="tEntity" id="trigger-entity" name="trigger-entity" class="pure-u-1" type="text" placeholder="map"> -->
              <select id="trigger-entity" name="trigger-entity" [(ngModel)]="triggerEntity" (ngModelChange)="changeEntity(0, $event)"
                class="pure-u-1">
                <option *ngFor="let entity of entities" [ngValue]="entity">{{entity.name}}</option>
              </select>
            </div>
          </div>

          <div class="pure-u-1 pure-u-md-1-3 auto" *ngIf="triggerEntity">
            <div class="pure-u-23-24">
              <label for="trigger-entity-property">Entity Attribute</label>
              <!-- <input [(ngModel)]="tEntity" id="trigger-entity" name="trigger-entity" class="pure-u-1" type="text" placeholder="map"> -->
              <select id="trigger-entity-property" name="trigger-entity-property" [(ngModel)]="trigger.attribute" class="pure-u-1">
                <option *ngFor="let attribute of triggerEntity.attributes" [ngValue]="attribute">{{attribute.name}}</option>
              </select>
            </div>
          </div>

          <div class="pure-u-1 pure-u-md-1-3 auto" *ngIf="trigger.attribute.type === 'number'">
            <div class="pure-u-23-24">
              <label for="trigger-operator">Operator</label>
              <select id="trigger-operator" name="trigger-operator" class="pure-u-1" [(ngModel)]="trigger.operator">
                <option value="eq">= (Equals)</option>
                <option value="lt">&lt; (Less Than)</option>
                <option value="lte">&le; (Less Than or Equal To)</option>
                <option value="gt">&gt; (Greather Than)</option>
                <option value="ge">&ge; (Greather Than or Equal To)</option>
              </select>
            </div>
          </div>

          <div *ngIf="trigger" class="pure-u-1 pure-u-md-1-3 auto">
            <div *ngFor="let field of trigger.attribute.fields">
              <div class="pure-u-23-24">
                <label for="trigger-value">Value {{field.unit ? "(" + field.unit +
                  ")" : ""}}</label>
                <input [(ngModel)]="trigger.value" id="trigger-value" name="trigger-value" class="pure-u-1" placeholder="0"
                  type="{{field.type ? field.type : 'text'}}">
              </div>
            </div>
          </div>
        </div>
      </fieldset>

      <fieldset>
        <legend>Action</legend>

        <div class="pure-g">
          <div class="pure-u-1 pure-u-md-1-3 auto">
            <div class="pure-u-23-24">
              <label for="action-entity">Entity</label>
              <!-- <input [(ngModel)]="tEntity" id="trigger-entity" name="trigger-entity" class="pure-u-1" type="text" placeholder="map"> -->
              <select id="action-entity" [(ngModel)]="actionEntity" (ngModelChange)="changeEntity(1, $event)" name="action-entity"
                class="pure-u-1">
                <option *ngFor="let entity of entities | onlyActions" [ngValue]="entity">{{entity.name}}</option>
              </select>
            </div>
          </div>

          <div class="pure-u-1 pure-u-md-1-3 auto" *ngIf="actionEntity">
            <div class="pure-u-23-24">
              <label for="action-entity-property">Entity Attribute</label>
              <select id="action-entity-property" name="action-entity-property" [(ngModel)]="action.attribute" class="pure-u-1">
                <option *ngFor="let attribute of actionEntity.attributes | onlyActionAttributes" [ngValue]="attribute">{{attribute.name}}</option>
              </select>
            </div>
          </div>

          <div class="pure-u-1 pure-u-md-1-3 auto">
            <div class="pure-u-23-24">
              <label for="action-value">Value</label>
              <input [(ngModel)]="action.value" id="action-value" name="action-value" class="pure-u-1" type="number"
                placeholder="0">
            </div>
          </div>
        </div>

      </fieldset>
      <button (click)="submitRule()" type="submit" class="pure-button pure-button-primary button-success" [ngClass]="{'pure-button-disabled': !isFormValid()}">
        <i class="far fa-check-circle"></i> Submit</button>
    </form>
  </div>
</div>

<!-- {
        "rules": [
            {
                "condition": {
                    "operator": "bg",
                    "entity": "light",
                    "constant": {
                        "value": 200,
                        "units": "lux"
                    }
                },
                "action": {
                    "entity": "map",
                    "attribute": "zoom",
                    "value": 15
                }
            }
        ]
    } -->
